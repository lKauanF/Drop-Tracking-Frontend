<main class="register" role="main">
  <section class="register__container" aria-labelledby="registerTitle">
  <!-- Marca 3D -->
    <header class="brand" aria-label="Drop Tracking">
      <app-marca-3d
        gotaPath="/assets/3dModel/LogoGota.glb"
        arcoPath="/assets/3dModel/LogoArco.glb"
        [gotaAnguloInicial]="0"
        [arcoAnguloInicial]="90">
      </app-marca-3d>

      <h1 id="registerTitle" class="brand__name">Cadastro</h1>
    </header>

    <!-- CARD -->
    <div class="card">
      <!-- Linha: CPF + Nome -->
      <div class="row-2">
        <!-- CPF -->
        <div class="field">
          <div class="control">
            <label class="sr-only" for="cpf">CPF</label>
            <input
              id="cpf"
              type="text"
              inputmode="numeric"
              placeholder="CPF:"
              maxlength="14"
              [value]="cpfMasked"
              (keydown)="onCpfKeydown($event)"
              (paste)="onCpfPaste($event)"
              (input)="onCpfInput($event)"
              (blur)="cpfTouched = true"
              [attr.aria-invalid]="cpfTouched && (!cpfCompleto || !cpfValido)"
            />
          </div>
          <small class="error" *ngIf="cpfTouched && !cpfCompleto">CPF deve ter 11 números.</small>
          <small class="error" *ngIf="cpfTouched && cpfCompleto && !cpfValido">CPF inválido.</small>
        </div>

        <!-- Nome -->
        <div class="field">
          <div class="control">
            <label class="sr-only" for="nome">Nome</label>
            <input
              id="nome"
              type="text"
              placeholder="Nome:"
              [value]="nome"
              (keydown)="onNomeKeydown($event)"
              (input)="onNomeInput($event)"
              (blur)="nomeTouched = true"
              [attr.aria-invalid]="nomeTouched && !nomeOk"
            />
          </div>
          <small class="error" *ngIf="nomeTouched && !nomeOk">Use apenas letras (mín. 2).</small>
        </div>
      </div>

      <!-- Senha -->
      <div class="field">
        <label class="sr-only" for="senha">Senha</label>
        <div class="password-wrapper">
          <input
            id="senha"
            [type]="showPass1 ? 'text' : 'password'"
            placeholder="Senha:"
            [value]="senha"
            (input)="onSenhaInput($event)"
            (blur)="senhaTouched = true"
            [attr.aria-invalid]="senhaTouched && !(lenOk && upperOk && numberOk && specialOk)"
          />
          <button
            type="button"
            class="toggle-eye"
            (click)="toggleEye(1)"
            [attr.aria-label]="showPass1 ? 'Ocultar senha' : 'Mostrar senha'">
            <ng-container *ngIf="!showPass1">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                   fill="none" stroke="#6b7a80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/>
              </svg>
            </ng-container>
            <ng-container *ngIf="showPass1">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                   fill="none" stroke="#6b7a80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20C5 20 1 12 1 12a21.77 21.77 0 0 1 5.06-6.94"/>
                <path d="M10.58 10.58a2 2 0 1 0 2.83 2.83"/><path d="M1 1l22 22"/>
              </svg>
            </ng-container>
          </button>
        </div>
      </div>

      <!-- Confirmar senha -->
      <div class="field">
        <label class="sr-only" for="confirmar">Confirmar Senha</label>
        <div class="password-wrapper">
          <input
            id="confirmar"
            [type]="showPass2 ? 'text' : 'password'"
            placeholder="Confirmar Senha:"
            [value]="confirmar"
            (input)="onConfirmarInput($event)"
            (blur)="confirmarTouched = true"
            [attr.aria-invalid]="confirmarTouched && !matchOk"
          />
          <button
            type="button"
            class="toggle-eye"
            (click)="toggleEye(2)"
            [attr.aria-label]="showPass2 ? 'Ocultar senha' : 'Mostrar senha'">
            <ng-container *ngIf="!showPass2">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                   fill="none" stroke="#6b7a80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/>
              </svg>
            </ng-container>
            <ng-container *ngIf="showPass2">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                   fill="none" stroke="#6b7a80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20C5 20 1 12 1 12a21.77 21.77 0 0 1 5.06-6.94"/>
                <path d="M10.58 10.58a2 2 0 1 0 2.83 2.83"/><path d="M1 1l22 22"/>
              </svg>
            </ng-container>
          </button>
        </div>
        <small class="error" *ngIf="confirmarTouched && !matchOk">As senhas não coincidem.</small>
      </div>

      <!-- Força + checklist -->
      <div class="strength-wrap" *ngIf="senha.length > 0">
        <div class="strength">
          <div class="strengthbar"><span class="fill" [style.width.%]="strengthPercent" [style.background]="strengthColor"></span></div>
          <span class="label">{{ strengthLabel }}</span>
        </div>
        <ul class="rules">
          <li [class.ok]="lenOk">8–20 caracteres</li>
          <li [class.ok]="upperOk">Pelo menos 1 letra maiúscula</li>
          <li [class.ok]="numberOk">Pelo menos 1 número</li>
          <li [class.ok]="specialOk">Pelo menos 1 caractere especial</li>
        </ul>
      </div>

      <!-- Ações -->
      <div class="actions">
        <button class="btn btn-primary" [disabled]="!formValid" (click)="onSubmit()">Cadastrar</button>
        <button class="btn btn-ghost" type="button" (click)="voltar()">Voltar</button>
      </div>
    </div>
  </section>
</main>
