<div class="layout">
  
  <main class="conteudo">
    <header class="topbar">
  <!-- coluna da esquerda: título ocupa 2 linhas -->
  <div class="title-row">
    <h2 class="title">Registros</h2>

    <!-- linha 2: AÇÕES (refresh + pdf) lado a lado -->
    <div class="acoes">
      <button
        mat-icon-button
        class="btn-icon"
        (click)="refresh()"
        [disabled]="carregando()"
        [class.spin]="carregando()"
        aria-label="Atualizar">
        <mat-icon>refresh</mat-icon>
      </button>

      <button
        mat-icon-button
        class="btn-icon"
        (click)="gerarPdf()"
        aria-label="Baixar PDF">
        <mat-icon>file_download</mat-icon>
      </button>
    </div>
  </div>

  <!-- direita: totais na mesma linha 2 -->
  <div class="meta-right">
    <span class="totais">{{ total() }} Resultados</span>
  </div>
</header>
<div class="hairline"></div>

    <section class="filtros">
  <mat-form-field appearance="outline" class="campo slim">
    <mat-label>Nome</mat-label>
    <input matInput [formControl]="filtros.controls.nome">
  </mat-form-field>

  <mat-form-field appearance="outline" class="campo slim">
    <mat-label>Prontuário</mat-label>
    <input matInput [formControl]="filtros.controls.prontuario">
  </mat-form-field>

  <mat-form-field appearance="outline" class="campo slim">
    <mat-label>Data de</mat-label>
    <input matInput [matDatepicker]="dp1" [formControl]="filtros.controls.data_de">
    <mat-datepicker #dp1></mat-datepicker>
  </mat-form-field>

  <mat-form-field appearance="outline" class="campo slim">
    <mat-label>Data até</mat-label>
    <input matInput [matDatepicker]="dp2" [formControl]="filtros.controls.data_ate">
    <mat-datepicker #dp2></mat-datepicker>
  </mat-form-field>

  <mat-form-field appearance="outline" class="campo slim">
    <mat-label>ID</mat-label>
    <input matInput [formControl]="filtros.controls.id_bomba" placeholder="Bomba 1">
  </mat-form-field>

  <div class="campo acoes-filtro">
    <button mat-stroked-button (click)="limparFiltros()">Limpar</button>
  </div>
</section>


    <!-- Tabela -->
    <section class="tabela">
      <div class="wrap" *ngIf="!carregando(); else carregandoTpl">
        <table>
          <thead>
            <tr>
              <th>Prontuário</th>
              <th>Nome</th>
              <th>Infusão</th>
              <th>Leito</th>
              <th>Alarme</th>
              <th>Hora do Alarme</th>
              <th>ID</th>
              <th>Data e Hora</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of registros()">
              <td>{{ r.prontuario }}</td>
              <td>{{ r.nome }}</td>
              <td>{{ r.infusao_taxa || '—' }}</td>
              <td>{{ r.leito }}</td>
              <td>
                <span class="tag" [class.alta]="r.alarme==='alto'" [class.baixa]="r.alarme==='baixo'">
                  {{ r.alarme === 'alto' ? 'Alto' : 'Baixo' }}
                </span>
              </td>
              <td>{{ r.hora_alarme || '—' }}</td>
              <td>{{ r.bomba_id }}</td>
              <td>{{ r.data_hora | date:'dd/MM/yyyy - HH:mm' }}</td>
            </tr>
            <tr *ngIf="registros().length === 0">
              <td colspan="8" class="vazio">Nenhum resultado.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #carregandoTpl>
        <div class="vazio">Carregando...</div>
      </ng-template>
    </section>

    <!-- Paginação -->
    <footer class="paginacao" *ngIf="paginas().length > 1">
      <button mat-icon-button (click)="irPara(paginaAtual()-1)" [disabled]="paginaAtual()===1">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <button mat-stroked-button
              *ngFor="let n of paginas()"
              [class.atual]="n===paginaAtual()"
              (click)="irPara(n)">
        {{ n }}
      </button>

      <button mat-icon-button (click)="irPara(paginaAtual()+1)" [disabled]="paginaAtual()===paginas().length">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </footer>
  </main>
</div>
